name: E2E for SFRA

on:
  pull_request:

jobs:
  run-e2e-matrix:
    if: ${{ github.actor != 'renovate[bot]' || github.actor != 'lgtm-com[bot]' }}    
    strategy:
      fail-fast: false
      matrix:
        include:
          - sfra-version: 'v5.3.0'
            node-version: '14'
            sfcc-hostname: ${{ secrets.SFCC_HOSTNAME_SFRA5 }}
            storefront-url: ${{ secrets.SFCC_STOREFRONT_URL_SFRA5 }}
            code-version: ${{ secrets.SFCC_CODE_VERSION_SFRA5 }}
          - sfra-version: 'v6.1.0'
            node-version: '14'
            sfcc-hostname: ${{ secrets.SFCC_HOSTNAME_SFRA6 }}
            storefront-url: ${{ secrets.SFCC_STOREFRONT_URL_SFRA6 }}
            code-version: ${{ secrets.SFCC_CODE_VERSION_SFRA6 }}
          - sfra-version: 'v7.0.0'
            node-version: '18'
            sfcc-hostname: ${{ secrets.SFCC_HOSTNAME_SFRA7 }}
            storefront-url: ${{ secrets.SFCC_STOREFRONT_URL_SFRA7 }}
            code-version: ${{ secrets.SFCC_CODE_VERSION_SFRA7 }}
    uses: ./.github/workflows/E2E_template.yml
    with:
      sfra-version: ${{ matrix.sfra-version }}
      node-version: ${{ matrix.node-version }}
      sfcc-hostname: ${{ matrix.sfcc-hostname }}
      code-version: ${{ matrix.code-version }}
      storefront-url: ${{ matrix.storefront-url }}
      is-main-branch: ${{ github.base_ref == 'main' }}
    secrets:
      SFCC_USERNAME: ${{ secrets.SFCC_USERNAME }}
      SFCC_PASSWORD: ${{ secrets.SFCC_PASSWORD }}
      SERVICE_ACCOUNT_SSH_KEY: ${{ secrets.SERVICE_ACCOUNT_SSH_KEY }}
      SANDBOX_HTTP_AUTH_USERNAME: ${{ secrets.SANDBOX_HTTP_AUTH_USERNAME }}
      SANDBOX_HTTP_AUTH_PASSWORD: ${{ secrets.SANDBOX_HTTP_AUTH_PASSWORD }}
      PAYPAL_USERNAME: ${{ secrets.PAYPAL_USERNAME }}
      PAYPAL_PASSWORD: ${{ secrets.PAYPAL_PASSWORD }}
      AMAZONPAY_USERNAME: ${{ secrets.AMAZONPAY_USERNAME }}
      AMAZONPAY_PASSWORD: ${{ secrets.AMAZONPAY_PASSWORD }}
